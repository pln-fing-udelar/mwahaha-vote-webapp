<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description"
        content="Leaderboard for the MWAHAHA competition on Humor Generation. We're on a quest to find the funniest computer program!"/>
  <meta
      content="Santiago Castro, Luis Chiruzzo, Naihao Deng, Julie-Anne Meaney, Santiago Góngora, Ignacio Sastre, Victoria Amoroso, Guillermo Rey, Salar Rahili, Guillermo Moncecchi, Juan José Prada, Aiala Rosá, Rada Mihalcea"
      name="author">
  <link href="img/favicon.avif" rel="apple-touch-icon">

  <meta property="og:type" content="website"/>
  <meta content="Which Computer Program Output is Funnier?" property="og:site_name"/>
  <meta content="https://thefunnier.com/img/og-leaderboard.avif" property="og:image"/>
  <meta property="og:image:height" content="630"/>
  <meta property="og:image:width" content="1200"/>
  <meta content="MWAHAHA Humor Gen Comp Leaderboard" property="og:title"/>
  <meta property="og:description"
        content="Leaderboard for the MWAHAHA competition on Humor Generation. We're on a quest to find the funniest computer program!"/>
  <meta content="https://thefunnier.com/leaderboard" property="og:url"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <!-- Twitter doesn't seem to support AVIF: -->
  <meta name="twitter:image" content="https://thefunnier.com/img/og-leaderboard.webp">
  <meta content="@HumorGen2026" name="twitter:site"/>
  <meta content="@HumorGen2026" name="twitter:creator"/>

  <title>MWAHAHA Humor Gen Comp Leaderboard</title>

  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <!--suppress HtmlDeprecatedAttribute -->
  <style type="text/tailwindcss">
    @theme {
      /* Custom Colors Migration */
      --color-gray-750: #2d3748;
      --color-gray-850: #1a202c;
      --color-gray-950: #0d1117;
    }

    /* Force class-based dark mode manually */
    @custom-variant dark (&:where(.dark, .dark *));

    /* Hide scrollbar for tab container but allow scroll */
    .hide-scroll::-webkit-scrollbar {
      display: none;
    }

    .hide-scroll {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/utc.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/timezone.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-40699CQRM6"></script>
  <!--suppress SpellCheckingInspection -->
  <script>
      if (document.location.hostname !== "localhost") {
          window.dataLayer = window.dataLayer || [];

          function gtag() {
              dataLayer.push(arguments);
          }

          gtag('js', new Date());
          gtag('config', 'G-40699CQRM6');
      }
  </script>
</head>

<body
    class="bg-gray-50 text-gray-800 font-sans selection:bg-blue-100 min-h-screen flex flex-col dark:bg-gray-900 dark:text-gray-100 transition-colors duration-200">

<!-- HEADER -->
<header
    class="bg-white border-b border-gray-200 sticky top-0 z-30 dark:bg-gray-800 dark:border-gray-700 transition-colors duration-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
    <div class="flex items-center space-x-3">
      <img src="img/favicon.avif" width="24" height="24" alt="Logo">
      <div>
        <h1 class="text-xl font-bold text-gray-900 tracking-tight dark:text-white">MWAHAHA Competition</h1>
        <p class="text-xs text-gray-500 font-medium uppercase tracking-wide dark:text-gray-400">
          Live Leaderboard
        </p>
      </div>
    </div>
    <div class="flex items-center space-x-3 sm:space-x-4">
      <!-- Live Indicator -->
      <div class="flex items-center gap-2 px-2 py-1 rounded-full bg-green-50 border border-green-100 dark:bg-green-900/20 dark:border-green-800 cursor-help"
           title="Connected for real-time updates">
        <span class="relative flex h-2.5 w-2.5">
          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
          <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"></span>
        </span>
        <span class="text-xs font-semibold text-green-700 dark:text-green-400 hidden sm:inline">Live</span>
      </div>

      <!-- Dark Mode Toggle -->
      <button id="theme-toggle"
              class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 focus:outline-none rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors cursor-pointer">
        <!-- Sun Icon -->
        <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path
              d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
              fill-rule="evenodd" clip-rule="evenodd"></path>
        </svg>
        <!-- Moon Icon -->
        <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
        </svg>
      </button>
    </div>
  </div>
</header>

<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-grow w-full">
  <!-- CONTROLS: TABS -->
  <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
    <!-- TABS -->
    <div class="hidden sm:flex p-1 space-x-1 bg-gray-200/60 rounded-xl overflow-x-auto hide-scroll dark:bg-gray-800"
         id="tabs-container">
      <!-- Tabs will be injected here by JS -->
    </div>

    <!-- TABS (Mobile Dropdown) -->
    <div class="block sm:hidden w-full">
      <label for="mobile-tabs" style="display: none">Task:</label>
      <select id="mobile-tabs"
              class="block w-full rounded-lg border-gray-300 py-2 pl-3 pr-10 text-base focus:border-blue-500 focus:outline-none focus:ring-blue-500 sm:text-sm dark:bg-gray-800 dark:border-gray-700 dark:text-white"
              onchange="switchTab(this.value)">
        <!-- Options injected by JS -->
      </select>
    </div>
  </div>

  <!-- TABLE CARD -->
  <div
      class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden dark:bg-gray-800 dark:border-gray-700 transition-colors duration-200">
    <div class="overflow-x-auto">
      <table class="w-full text-left border-collapse">
        <thead>
        <tr class="bg-gray-50 border-b border-gray-200 text-xs uppercase tracking-wider text-gray-500 font-semibold dark:bg-gray-900/50 dark:border-gray-700 dark:text-gray-400">
          <th class="px-6 py-4 cursor-pointer hover:bg-gray-100 group w-24 text-center sort-header dark:hover:bg-gray-700"
              data-key="final_ranking">
            <div class="flex items-center justify-end">
              Rank <span class="sort-icon ml-1"></span>
            </div>
          </th>
          <th class="px-6 py-4 cursor-pointer hover:bg-gray-100 group sort-header text-center dark:hover:bg-gray-700"
              data-key="system">
            <div class="flex items-center justify-center">
              System <span class="sort-icon ml-1"></span>
            </div>
          </th>
          <th class="px-6 py-4 cursor-pointer hover:bg-gray-100 group text-center sort-header dark:hover:bg-gray-700"
              data-key="rating">
            <div class="flex items-center justify-center">
              Rating <span class="sort-icon ml-1"></span>
            </div>
          </th>
          <th class="px-6 py-4 text-center cursor-default">
            95% CI
          </th>
          <th class="px-6 py-4 cursor-pointer hover:bg-gray-100 group text-center sort-header dark:hover:bg-gray-700"
              data-key="num_battles">
            <div class="flex items-center justify-center">
              Votes <span class="sort-icon ml-1"></span>
            </div>
          </th>
        </tr>
        </thead>
        <tbody id="leaderboard-body" class="divide-y divide-gray-100 dark:divide-gray-700">
        <!-- Rows injected by JS -->
        </tbody>
      </table>
    </div>

    <div class="bg-gray-50 px-6 py-4 border-t border-gray-200 dark:bg-gray-800 dark:border-gray-700">
      <p class="text-xs text-gray-500 text-center dark:text-gray-400" id="last-updated">
        <!-- Date injected by JS -->
      </p>
    </div>
  </div>
</main>

<footer
    class="bg-white border-b border-gray-200 sticky top-0 z-30 dark:bg-gray-800 dark:border-gray-700 transition-colors duration-200 flex items-center">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
    <div class="flex items-center space-x-2 sm:space-x-4 gap-2">
      <!--suppress HtmlUnknownAttribute -->
      <button command="show-modal" commandfor="dialog"
              class="lg:flex text-sm text-gray-500 hover:text-blue-600 transition-colors dark:text-gray-400 dark:hover:text-blue-400 cursor-pointer">
        More Info
      </button>
      <a href="https://thefunnier.com/" target="_blank"
         class="sm:flex px-3 py-2 bg-pink-600 text-white text-sm font-medium rounded-md hover:bg-pink-700 transition-colors shadow-sm items-center">
        <span>Help us Rank!</span>
      </a>
      <a href="https://www.codabench.org/competitions/9719/" target="_blank"
         class="hidden sm:flex px-4 py-2 bg-gray-900 text-white text-sm font-medium rounded-md hover:bg-gray-800 transition-colors shadow-sm dark:bg-blue-600 dark:hover:bg-blue-700">
        Submit a System
      </a>
    </div>
  </div>
</footer>

<!--suppress HtmlUnknownTag -->
<el-dialog>
  <dialog id="dialog" aria-labelledby="dialog-title"
          class="fixed inset-0 size-auto max-h-none max-w-none overflow-y-auto bg-transparent backdrop:bg-transparent">
    <!--suppress HtmlUnknownTag -->
    <el-dialog-backdrop
        class="fixed inset-0 bg-gray-500/75 transition-opacity data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in dark:bg-gray-900/50"></el-dialog-backdrop>

    <div tabindex="0"
         class="flex min-h-full items-end justify-center p-4 text-center focus:outline-none sm:items-center sm:p-0">
      <!--suppress HtmlUnknownTag -->
      <el-dialog-panel
          class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all data-closed:translate-y-4 data-closed:opacity-0 data-enter:duration-300 data-enter:ease-out data-leave:duration-200 data-leave:ease-in sm:my-8 sm:w-full sm:max-w-lg data-closed:sm:translate-y-0 data-closed:sm:scale-95 dark:bg-gray-800 dark:outline dark:-outline-offset-1 dark:outline-white/10">
        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 dark:bg-gray-800">
          <div class="sm:flex sm:items-start">
            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
              <h3 class="text-base font-semibold text-gray-900 dark:text-white">Info</h3>
              <div class="mt-2">
                <p class="text-sm text-gray-500 dark:text-gray-400">
                  This web page shows the live arena leaderboard for the evaluation of systems submitted by participants
                  to the
                  <a href="https://pln-fing-udelar.github.io/semeval-2026-humor-gen/" target="_blank"
                     class="underline text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-500">
                    2025-2026 MWAHAHA competition on Humor Generation</a>.
                  In this competition, participants submit computer program systems that are capable of generating
                  humorous outputs given some context (e.g., a headline).
                  This competition consists of two phases in which participants can submit systems:
                  Evaluation Trial (until Dec 15, 2025) and Evaluation (Jan 10-31, 2026).
                  We use this web page to show the live evaluation results for both phases,
                  one at a time (currently for the Evaluation Trial).
                  The results are non-final (they are partial; running, live, still being computed).
                </p>
              </div>
            </div>
          </div>
        </div>
        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 dark:bg-gray-800">
          <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
            <h3 class="text-base font-semibold text-gray-900 dark:text-white">Frequently Asked Questions (FAQ)</h3>
            <div class="mt-2">
              <p class="text-sm text-gray-500 dark:text-gray-400">
                <strong>1. What are these systems?</strong>
                <br>
                These are the names of the systems participants submitted to this competition.
                These systems generate jokes given a prompt (e.g., a headline).
                The names of the systems are composed of the participant name, a hyphen, and the submission number,
                obtained from
                <a href="https://www.codabench.org/competitions/9719/" target="_blank"
                   class="underline text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-500">
                  our CodaBench competition website</a>.
              </p>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                <strong>2. Why do some systems have similar names?</strong>
                <br>
                Participants are allowed to make multiple submissions.
                So the participant name can appear multiple times, with a different submission number.
              </p>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                <strong>3. What's <em>baseline-1</em>?</strong>
                <br>
                It's the name of a system provided by the competition organizers as a baseline.
              </p>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                <strong>4. How are the systems evaluated?</strong>
                <br>
                We use
                <a href="/" target="_blank"
                   class="underline text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-500">
                  this annotation web page</a>
                to let anyone on the Internet help us
                decide what's the funnier system on 1-on-1 arena-style battles,
                partially inspired by
                <a href="https://lmarena.ai/" target="_blank"
                   class="underline text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-500">
                  LMArena</a>.
                With all the annotations, we compute an Elo-like rating score to rate the systems.
                A higher rating indicates a system that is more likely to generate outputs perceived as humorous.
                This is a system used by LMArena and also by games such as chess.
                More specifically, we employ a Bradley-Terry model to compute stable ratings,
                and apply bootstrapping to compute 95% confidence intervals.
                Note that, in some border cases, there could be differences between the confidence intervals
                and the final rating values.
                See
                <a href="https://lmsys.org/blog/2023-12-07-leaderboard/" target="_blank"
                   class="underline text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-500">
                  this blog post from LMSYS Org</a>
                for more info.
              </p>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                <strong>5. Why do some systems have the same rank?</strong>
                <br>
                Some systems have the same rank because we can't differentiate them in a statistically significant way,
                even when their ratings are different.
                Note that ties aren't transitive.
                For example, we may not be able to tell which of A and B and which of B and C are better,
                but we may be able to significantly tell that A is better than C.
                That's why a system may have a lower rank than another one without a statistically significant
                difference (because there are others systems with the same rank as the latter that can be differentiated
                from the former).
              </p>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                <strong>6. Why do some systems have fewer votes than others?</strong>
                <br>
                Some systems were submitted more recently.
              </p>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                <strong>7. When is the leaderboard updated?</strong>
                <br>
                We target to update it every one hour, but there may be issues so we can't guarantee it.
                In any case, the last update time appears at the bottom of the tables.
              </p>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                <strong>8. Can I evaluate systems?</strong>
                <br>
                Yes!
                Everyone is welcome!
                Visit the
                <a href="/" target="_blank"
                   class="underline text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-500">
                  the annotation web page</a>
                and have fun rating the funnier systems!
                Note that you can't both submit a system and evaluate systems.
                In other words, only non-participants can evaluate systems.
                If you're considering participating in the competition, please refrain from evaluating systems.
              </p>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                <strong>9. Can I participate in this competition?</strong>
                <br>
                Of course!
                Everyone is welcome!
                Visit the
                <a href="https://pln-fing-udelar.github.io/semeval-2026-humor-gen/" target="_blank"
                   class="underline text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-500">
                  2025-2026 MWAHAHA competition website</a>
                for more info.
                You have time to submit your system's jokes until the Evaluation phase ends (late Jan, 2026).
                Note that, if you are considering participating, you cannot vote/annotate
                (i.e., you can't both submit a system and evaluate systems).
              </p>
            </div>
          </div>
        </div>
        <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 dark:bg-gray-700/25">
          <!--suppress HtmlUnknownAttribute -->
          <button type="button" command="close" commandfor="dialog"
                  class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-xs inset-ring inset-ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto dark:bg-white/10 dark:text-white dark:shadow-none dark:inset-ring-white/5 dark:hover:bg-white/20">
            Got it!
          </button>
        </div>
      </el-dialog-panel>
    </div>
  </dialog>
</el-dialog>

<script>
    // --- STATE & CONFIG ---
    let activeTab = "a-en";
    const dataSets = {};
    let sortConfig = {key: 'rating', direction: 'desc'};
    const TASKS = ["a-en", "a-es", "a-zh", "b1", "b2"];
    let taskLastModified = {}; // Stores date strings per task

    // --- DOM ELEMENTS ---
    const tabsContainer = document.getElementById("tabs-container");
    const mobileTabsSelect = document.getElementById("mobile-tabs");
    const leaderboardBody = document.getElementById("leaderboard-body");
    const themeToggleBtn = document.getElementById("theme-toggle");
    const themeToggleDarkIcon = document.getElementById("theme-toggle-dark-icon");
    const themeToggleLightIcon = document.getElementById("theme-toggle-light-icon");

    // --- SVG ICONS ---
    const icons = {
        globe: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/><path d="M2 12h20"/></svg>`,
        fileText: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg>`,
        image: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>`,
        chevronUp: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600 inline-block ml-1 dark:text-blue-400"><polyline points="18 15 12 9 6 15"/></svg>`,
        chevronDown: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600 inline-block ml-1 dark:text-blue-400"><polyline points="6 9 12 15 18 9"/></svg>`,
        alertCircle: `<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-gray-300 mb-3 dark:text-gray-600"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>`
    };

    const tabs = [
        {id: "a-en", label: "Task A: Joke in English", icon: icons.fileText},
        {id: "a-es", label: "Task A: Joke in Spanish", icon: icons.fileText},
        {id: "a-zh", label: "Task A: Joke in Chinese", icon: icons.fileText},
        {id: "b1", label: "Task B1: Caption the GIF", icon: icons.image},
        {id: "b2", label: "Task B2: Fill in the GIF Caption", icon: icons.image},
    ];

    // --- DARK MODE LOGIC ---
    function initTheme() {
        if (localStorage.getItem("color-theme") === "dark" || (!("color-theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
            document.documentElement.classList.add("dark");
            themeToggleDarkIcon.classList.remove("hidden");
        } else {
            document.documentElement.classList.remove("dark");
            themeToggleLightIcon.classList.remove("hidden");
        }
    }

    themeToggleBtn.addEventListener("click", () => {
        // Toggle icons
        themeToggleDarkIcon.classList.toggle("hidden");
        themeToggleLightIcon.classList.toggle("hidden");

        // Toggle Dark Mode
        if (localStorage.getItem("color-theme")) {
            if (localStorage.getItem("color-theme") === "light") {
                document.documentElement.classList.add("dark");
                localStorage.setItem("color-theme", "dark");
            } else {
                document.documentElement.classList.remove("dark");
                localStorage.setItem("color-theme", "light");
            }
        } else {
            if (document.documentElement.classList.contains("dark")) {
                document.documentElement.classList.remove("dark");
                localStorage.setItem("color-theme", "light");
            } else {
                document.documentElement.classList.add("dark");
                localStorage.setItem("color-theme", "dark");
            }
        }
    });

    // --- INIT LOGIC (Language & Params) ---
    function initApp() {
        initTheme();

        const urlParams = new URLSearchParams(window.location.search);
        const tabParam = urlParams.get("task");

        if (tabParam && TASKS.includes(tabParam)) {
            activeTab = tabParam;
        } else {
            // Language detection
            if (navigator.language.startsWith("es")) {
                activeTab = "a-es";
            } else if (navigator.language.startsWith("zh")) {
                activeTab = "a-zh";
            } else {
                activeTab = "a-en";
            }
            // Update URL to reflect default
            updateUrlParam(activeTab);
        }

        dayjs().format();

        dayjs.extend(window.dayjs_plugin_utc);
        dayjs.extend(window.dayjs_plugin_timezone);
        dayjs.extend(window.dayjs_plugin_relativeTime);
    }

    function updateUrlParam(tabId) {
        if (history.pushState) {
            const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname + "?task=" + tabId;
            window.history.pushState({path: newUrl}, "", newUrl);
        }
    }

    // --- RENDER FUNCTIONS ---

    function renderTabs() {
        // Desktop Tabs
        tabsContainer.innerHTML = tabs.map(tab => {
            const isActive = activeTab === tab.id;
            const baseClasses = "flex items-center gap-2 px-4 py-2.5 text-sm font-semibold rounded-lg transition-all duration-200 whitespace-nowrap cursor-pointer select-none";
            const activeClasses = "bg-white text-blue-600 shadow-sm ring-1 ring-black/5 dark:bg-gray-700 dark:text-blue-400 dark:ring-gray-600";
            const inactiveClasses = "text-gray-600 hover:bg-gray-200/50 hover:text-gray-900 dark:text-gray-400 dark:hover:bg-gray-700/50 dark:hover:text-gray-200";

            return `
                <div
                    onclick="switchTab('${tab.id}')"
                    class="${baseClasses} ${isActive ? activeClasses : inactiveClasses}"
                >
                    ${tab.icon}
                    ${tab.label}
                </div>
            `;
        }).join("");

        // Mobile Dropdown
        mobileTabsSelect.innerHTML = tabs.map(tab => {
            return `<option value="${tab.id}" ${activeTab === tab.id ? 'selected' : ''}>${tab.label}</option>`;
        }).join("");
    }

    function renderSortIcons() {
        document.querySelectorAll(".sort-header").forEach(header => {
            const key = header.getAttribute("data-key");
            const iconContainer = header.querySelector(".sort-icon");

            if (sortConfig.key === key) {
                iconContainer.innerHTML = sortConfig.direction === "asc" ? icons.chevronUp : icons.chevronDown;
                iconContainer.classList.remove('opacity-0');
            } else {
                iconContainer.innerHTML = '<span class="text-gray-300 opacity-0 group-hover:opacity-100 transition-opacity dark:text-gray-600">↕</span>';
            }
        });
    }

    function getRankIcon(rank) {
        return `<span class="text-gray-500 font-mono dark:text-gray-400">${rank}</span>`;
    }

    function getRowStyle(rank, systemName) {
        // Baseline special color
        if (systemName === "baseline-1") {
            return "bg-purple-100 hover:bg-purple-200 dark:bg-purple-900/20 dark:hover:bg-purple-900/30";
        }
        // Top 3 colors
        if (rank === 1) return "bg-amber-100 hover:bg-amber-200 dark:bg-amber-400/20 dark:hover:bg-amber-400/30";
        if (rank === 2) return "bg-gray-300 hover:bg-gray-400 dark:bg-gray-500/50 dark:hover:bg-gray-500/80";
        if (rank === 3) return "bg-orange-200 hover:bg-orange-300 dark:bg-orange-300/30 dark:hover:bg-orange-400/40";
        // Default
        return "hover:bg-blue-50/30 dark:hover:bg-gray-700/30";
    }

    // Helper: Update footer time separately to avoid full re-render
    function updateFooterTime() {
        if (!taskLastModified[activeTab]) return;
        const lastMod = dayjs(taskLastModified[activeTab]);
        const lastUpdatedText = document.getElementById("last-updated");
        if (lastUpdatedText) {
            lastUpdatedText.textContent = `Last updated: ${lastMod.fromNow()}`;
            lastUpdatedText.setAttribute("title", lastMod.tz(dayjs.tz.guess()).format());
        }
    }

    function renderTable() {
        // 1. Get Data
        let data = [...(dataSets[activeTab] || [])];

        // Update the footer text
        updateFooterTime();

        // 2. Sort Data
        if (sortConfig.key) {
            data.sort((a, b) => {
                const valA = a[sortConfig.key];
                const valB = b[sortConfig.key];
                if (valA < valB) return sortConfig.direction === "asc" ? -1 : 1;
                if (valA > valB) return sortConfig.direction === "asc" ? 1 : -1;
                return 0;
            });
        }

        // 3. Render Rows
        if (data.length === 0) {
            leaderboardBody.innerHTML = `
                <tr>
                    <td colspan="6" class="px-6 py-12 text-center text-gray-500 dark:text-gray-400">
                        ${icons.alertCircle}
                        <p>No data available for this task.</p>
                    </td>
                </tr>
            `;
            return;
        }

        // Calculate global min/max for CI bars scaling within this view
        let allLowers = data.map(d => d.rating_q025);
        let allUppers = data.map(d => d.rating_q975);
        let minVal = Math.min(...allLowers);
        let maxVal = Math.max(...allUppers);
        // Add padding to range
        let range = maxVal - minVal;
        if (range === 0) range = 100; // avoid div by zero

        leaderboardBody.innerHTML = data.map((row) => {
            const upper = Math.round(row.rating_q975);
            const lower = Math.round(row.rating_q025);
            const rating = Math.round(row.rating);

            // Calculate CI Bar dimensions
            const leftPercent = ((row.rating_q025 - minVal) / range) * 100;
            const widthPercent = ((row.rating_q975 - row.rating_q025) / range) * 100;
            const meanPercent = ((row.rating - minVal) / range) * 100;

            const rowClass = getRowStyle(row.final_ranking, row.system);

            return `
                <tr class="${rowClass} transition-colors duration-150 group border-b border-gray-100 dark:border-gray-800">
                    <td class="px-6 py-4 text-center font-medium">
                        <div class="flex justify-center items-center">
                            ${getRankIcon(row.final_ranking)}
                        </div>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <span class="font-semibold text-gray-900 group-hover:text-blue-700 transition-colors dark:text-gray-100 dark:group-hover:text-blue-400">
                            ${row.system}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-bold bg-white text-gray-800 border border-gray-200 dark:bg-gray-700 dark:text-gray-200 dark:border-gray-600">
                            ${rating}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <div class="flex flex-col items-center justify-center text-xs text-gray-500 dark:text-gray-400">
                            <span class="font-medium text-gray-700 dark:text-gray-300">
                                [${lower}, ${upper}]
                            </span>
                            <div class="w-32 h-2 bg-gray-200 rounded-full mt-1 relative dark:bg-gray-700 overflow-hidden">
                                <!-- The Bar -->
                                <div
                                    class="absolute top-0 bottom-0 bg-blue-400/50 rounded-full dark:bg-blue-500/50"
                                    style="left: ${leftPercent}%; width: ${widthPercent}%;"
                                ></div>
                                <!-- The Mean Marker (optional, helps visualization) -->
                                <div
                                    class="absolute top-0 bottom-0 w-0.5 bg-gray-600 dark:bg-white"
                                    style="left: ${meanPercent}%; transform: translateX(-50%);"
                                ></div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 text-center font-mono text-sm text-gray-600 dark:text-gray-400">
                        ${row.num_battles}
                    </td>
                </tr>
            `;
        }).join("");

        renderSortIcons();
    }

    // --- ACTIONS ---

    function switchTab(tabId) {
        activeTab = tabId;
        updateUrlParam(tabId);
        renderTabs();
        renderTable();
    }

    function handleSort(key) {
        let direction = "desc";
        if (sortConfig.key === key && sortConfig.direction === "desc") {
            direction = "asc";
        }
        sortConfig = {key, direction};
        renderTable();
    }

    // --- DATA LOADING ---

    async function loadInitialData() {
        const promises = TASKS.map(async (task) => {
            try {
                const response = await fetch(`scores/${task}.json`);
                if (!response.ok) {
                    console.warn(`No data found for ${task} at scores/${task}.json`);
                    return;
                }
                const lastModified = response.headers.get("Last-Modified");
                if (lastModified) {
                    // Convert to local readable string
                    taskLastModified[task] = lastModified;
                }

                dataSets[task] = await response.json();
            } catch (e) {
                console.error(`Error loading data for ${task}:`, e);
            }
        });

        await Promise.all(promises);
        renderTable(); // Re-render after fetching
    }

    // --- EVENT LISTENERS ---

    // Sort Headers
    document.querySelectorAll(".sort-header").forEach(header =>
        header.addEventListener("click", () => handleSort(header.getAttribute("data-key"))));

    // --- TIMERS ---

    // 1. Update the "Last updated" text every 60 seconds (1 minute)
    setInterval(updateFooterTime, 60000);

    // 2. Re-fetch JSON data every 30 minutes
    setInterval(loadInitialData, 1800000);

    // --- START ---
    initApp();
    renderTabs();
    loadInitialData();
</script>
</body>
</html>
